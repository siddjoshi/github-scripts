from datetime import datetime
from typing import Optional, Tuple

from github import Github
from github.Repository import Repository


def _get_repo(client: Github, full_name: str) -> Repository:
    return client.get_repo(full_name)


def has_repo_changed(
    client: Github, full_name: str, since: Optional[datetime]
) -> Tuple[bool, Optional[str]]:
    """
    Returns (changed, latest_commit_sha)
    - changed: True if repo has commits after `since` or since is None
    - latest_commit_sha: SHA of most recent commit (if available)
    """
    repo = _get_repo(client, full_name)
    if since is None:
        commits = repo.get_commits()
    else:
        commits = repo.get_commits(since=since)

    try:
        latest_commit = commits[0]
        latest_sha = latest_commit.sha
    except Exception:
        # No commits found
        return False, None

    if since is None:
        return True, latest_sha

    # If any commit is returned, repo changed
    return True, latest_sha

